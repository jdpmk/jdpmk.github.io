<html>
  <!-- Load d3.js -->
  <script src='https://d3js.org/d3.v5.min.js'></script>

  <!-- Load d3-annotation -->
  <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>

  <!-- CSS -->
  <style>
    body {
      font-family: Helvetica;
      margin: 50px;
    }
    svg.frame {
      border-style: solid;
      padding: 10px;
    }
    ul.nav {
      display: inline-block;
      padding-left: 0px;
    }
    li.navbutton {
      padding: 5px;
      cursor: pointer;
      display: inline;
      border-style: solid;
      opacity: 33%;
    }
    #subtitle {
      margin-left: 20px;
      display: inline-block;
    }
    .longform {
      max-width: 1024px;
    }
    .annotations {
      font-size: 11px;
    }
  </style>

  <!-- HTML body -->
  <body onload="nav1()">
    <div class="container">
      <h1>S&P 500: 1990 to 2023</h1>
      <div class="longform">
          This visualization tracks the history of the S&P 500, a stock market
          index of the 500 largest companies in the United States, from 1990 to
          2023. Many major events are highlighted, to provide historical
          context for economic growth and downturns.
          Use the buttons below to navigate the visualization.
      </div>
      <br>
      <div class="horizontal">
        <ul class="nav">
          <li id="nav1" onClick="updateSelectedSlide(1)" class="navbutton">1</li>
          <li id="nav2" onClick="updateSelectedSlide(2)" class="navbutton">2</li>
          <li id="nav3" onClick="updateSelectedSlide(3)" class="navbutton">3</li>
          <li id="nav4" onClick="updateSelectedSlide(4)" class="navbutton">4</li>
          <li id="nav5" onClick="updateSelectedSlide(5)" class="navbutton">5</li>
        </ul>
        <h2 id="subtitle"></h2>
      <div>
      <svg class="frame"></svg>
      <div class="longform" id="summary"></div>
    <div>

    <!-- d3.js script -->
    <script>
      // === References ===
      // - Margin convention: https://observablehq.com/@d3/margin-convention
      // - Working with dates: http://using-d3js.com/04_04_working_with_dates.html
      // - Basic line chart: https://d3-graph-gallery.com/graph/line_basic.html

      // === Constants ===

      const margin = ({top: 40, right: 40, bottom: 40, left: 70});
      const width = 1024;
      const height = 576;

      // === Page navigation ===

      async function updateSelectedSlide(i) {
        document.getElementById("nav" + selectedSlide).style.opacity = "33%";
        selectedSlide = i;
        document.getElementById("nav" + selectedSlide).style.opacity = "100%";

        if (i == 1) nav1();
        if (i == 2) nav2();
        if (i == 3) nav3();
        if (i == 4) nav4();
        if (i == 5) nav5();
      }

      let selectedSlide = 1;
      updateSelectedSlide(selectedSlide);

      // === Helpers ===

      // Load CSV data (see README for original data source)
      async function fetchData() {
        const url = "https://joydeep.dev/cs416su23/sp500.csv";
        const raw = await d3.csv(url);

        const parseTime = d3.timeParse("%Y-%m-%d");

        const data = raw
          // Filter out entries not for the first day of the month
          .filter(entry =>
            ["28", "30", "31"].every(day => !entry.Date.includes(day))
          )
          // Per-function filtering predicate
          // .filter(entry => predicate(entry))
          // Parse time for use in D3 axes
          .map(entry => {
            return {
              Date: parseTime(entry.Date),
              Value: entry.Value
            };
          });

        console.log("[DEBUG] Loaded data successfully.");
        return data;
      }

      // === Charts for each slide ===

      async function nav1() {
        document.getElementById("subtitle").innerText = "Early 2000s: The Dot-Com Bubble";

        const data = await fetchData();

        const xScale = d3.scaleTime()
            .domain(d3.extent(data.map(e => e.Date)))
            .range([margin.left, width - margin.right]);
        const yScale = d3.scaleLinear()
            .domain([0, d3.max(data, d => +d.Value)])
            .range([height - margin.bottom, margin.top]);

        var xAxis = d3.axisBottom(xScale).ticks(d3.timeYear);
        var yAxis = d3.axisLeft(yScale);

        d3.select("svg").html("");
        const svg = d3.select("svg")
                      .attr("width", width)
                      .attr("height", height);

        svg.append("g")
            .attr("transform", "translate(0," + (height - margin.bottom) + ")")
            .call(xAxis);
        svg.append("g")
           .attr("transform", "translate(" + margin.left + ",0)")
           .call(yAxis);
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("x", width / 2)
            .attr("y", height)
            .text("Year");
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("transform", "rotate(-90)")
            .attr("x", -height / 2 + margin.top)
            .attr("y", 20)
            .text("S&P 500 Index");

        svg.append("path")
           .datum(data.filter(e => e.Date <= new Date(2000, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 3)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2000, 01, 01) &&
             e.Date <= new Date(2003, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 3)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));

        const annotations = [
          {
            note: {
              label: "Suppose you invested $10,000 into the S&P 500 in January 1990. We will track the value of this investment over time.",
              wrap: 200,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(1990, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(1990, 01, 01).getTime()).Value),
            dy: -225,
            dx: 25,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "A bull run in the late 1990s was fueled by fast growing Internet companies.",
              align: "middle",
              wrap: 150,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(1996, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(1996, 01, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The S&P 500 hit an all-time high of 1552.87 on March 24, 2000. At this point in time, your investment from 1990 would be worth around $46,000.",
              align: "right",
              wrap: 100,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2000, 03, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2000, 03, 01).getTime()).Value),
            dy: -200,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "At its lowest point around October 2002, the stock market had lost $5 trillion in market capitalization.",
              align: "middle",
              wrap: 75,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2002, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2002, 10, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          }
        ];
        svg.append("g")
           .call(d3.annotation().annotations(annotations));
      }

      async function nav2() {
        document.getElementById("subtitle").innerText = "Late 2000s: The Great Recession and Housing Crisis";

        const data = await fetchData();

        const xScale = d3.scaleTime()
            .domain(d3.extent(data.map(e => e.Date)))
            .range([margin.left, width - margin.right]);
        const yScale = d3.scaleLinear()
            .domain([0, d3.max(data, d => +d.Value)])
            .range([height - margin.bottom, margin.top]);

        var xAxis = d3.axisBottom(xScale).ticks(d3.timeYear);
        var yAxis = d3.axisLeft(yScale);

        d3.select("svg").html("");
        const svg = d3.select("svg")
                      .attr("width", width)
                      .attr("height", height);

        svg.append("g")
            .attr("transform", "translate(0," + (height - margin.bottom) + ")")
            .call(xAxis);
        svg.append("g")
           .attr("transform", "translate(" + margin.left + ",0)")
           .call(yAxis);
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("x", width / 2)
            .attr("y", height)
            .text("Year");
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("transform", "rotate(-90)")
            .attr("x", -height / 2 + margin.top)
            .attr("y", 20)
            .text("S&P 500 Index");

        svg.append("path")
           .datum(data.filter(e => e.Date <= new Date(2000, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2000, 01, 01) &&
             e.Date <= new Date(2003, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2003, 01, 01) &&
             e.Date <= new Date(2007, 02, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 3)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2007, 01, 01) &&
             e.Date <= new Date(2009, 02, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 3)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));

        const annotations = [
          {
            note: {
              label: "Suppose you invested $10,000 into the S&P 500 in January 1990. We will track the value of this investment over time.",
              wrap: 200,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(1990, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(1990, 01, 01).getTime()).Value),
            dy: -225,
            dx: 25,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "A bull run in the late 1990s was fueled by fast growing Internet companies.",
              align: "middle",
              wrap: 150,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(1996, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(1996, 01, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The S&P 500 hit an all-time high of 1552.87 on March 24, 2000. At this point in time, your investment from 1990 would be worth around $46,000.",
              align: "right",
              wrap: 100,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2000, 03, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2000, 03, 01).getTime()).Value),
            dy: -200,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "At its lowest point around October 2002, the stock market had lost $5 trillion in market capitalization.",
              align: "middle",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2002, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2002, 10, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The housing bubble bursts, after housing prices peak in 2006, kicking off a mortage crisis.",
              align: "right",
              wrap: 150,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2007, 02, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2007, 02, 01).getTime()).Value),
            dy: 75,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "On October 11, 2007, the S&P 500 hit an all-time high 1576.09. At this point in time, your investment from 1990 would be worth around $46,000.",
              align: "middle",
              wrap: 150,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2007, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2007, 10, 01).getTime()).Value),
            dy: -175,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "On September 26, 2008, Washington Mutual goes bankrupt after a bank run.",
              align: "left",
              wrap: 75,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2008, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2008, 10, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          }
        ];
        svg.append("g")
           .call(d3.annotation().annotations(annotations));
      }

      async function nav3() {
        document.getElementById("subtitle").innerText = "2010s: Growth and the COVID-19 Pandemic";

        const data = await fetchData();

        const xScale = d3.scaleTime()
            .domain(d3.extent(data.map(e => e.Date)))
            .range([margin.left, width - margin.right]);
        const yScale = d3.scaleLinear()
            .domain([0, d3.max(data, d => +d.Value)])
            .range([height - margin.bottom, margin.top]);

        var xAxis = d3.axisBottom(xScale).ticks(d3.timeYear);
        var yAxis = d3.axisLeft(yScale);

        d3.select("svg").html("");
        const svg = d3.select("svg")
                      .attr("width", width)
                      .attr("height", height);

        svg.append("g")
            .attr("transform", "translate(0," + (height - margin.bottom) + ")")
            .call(xAxis);
        svg.append("g")
           .attr("transform", "translate(" + margin.left + ",0)")
           .call(yAxis);
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("x", width / 2)
            .attr("y", height)
            .text("Year");
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("transform", "rotate(-90)")
            .attr("x", -height / 2 + margin.top)
            .attr("y", 20)
            .text("S&P 500 Index");

        svg.append("path")
           .datum(data.filter(e => e.Date <= new Date(2000, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2000, 01, 01) &&
             e.Date <= new Date(2003, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2003, 01, 01) &&
             e.Date <= new Date(2007, 02, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2007, 01, 01) &&
             e.Date <= new Date(2009, 02, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2009, 02, 01) &&
             e.Date <= new Date(2020, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 3)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2020, 01, 01) &&
             e.Date <= new Date(2020, 03, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 3)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));

        const annotations = [
          {
            note: {
              label: "Suppose you invested $10,000 into the S&P 500 in January 1990. We will track the value of this investment over time.",
              wrap: 200,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(1990, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(1990, 01, 01).getTime()).Value),
            dy: -225,
            dx: 25,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "A bull run in the late 1990s was fueled by fast growing Internet companies.",
              align: "middle",
              wrap: 150,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(1996, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(1996, 01, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The S&P 500 hit an all-time high of 1552.87 on March 24, 2000. At this point in time, your investment from 1990 would be worth around $46,000.",
              align: "right",
              wrap: 100,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2000, 03, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2000, 03, 01).getTime()).Value),
            dy: -200,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "At its lowest point around October 2002, the stock market had lost $5 trillion in market capitalization.",
              align: "middle",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2002, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2002, 10, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The housing bubble bursts, after housing prices peak in 2006, kicking off a mortage crisis.",
              align: "right",
              wrap: 150,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2007, 02, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2007, 02, 01).getTime()).Value),
            dy: 75,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "On October 11, 2007, the S&P 500 hit an all-time high 1576.09. At this point in time, your investment from 1990 would be worth around $46,000.",
              align: "middle",
              wrap: 150,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2007, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2007, 10, 01).getTime()).Value),
            dy: -175,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "On September 26, 2008, Washington Mutual goes bankrupt after a bank run.",
              align: "left",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2008, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2008, 10, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The S&P 500 regains the closing record from October 2007.",
              align: "middle",
              wrap: 75,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2013, 03, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2013, 03, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "Through the 2010s, the S&P 500 grows steadily in one of the longest periods of market growth. ",
              align: "right",
              wrap: 75,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2017, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2017, 01, 01).getTime()).Value),
            dy: 100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "In February 2020, the onset of the COVID-19 pandemic ends the peak of the bull run from 2009. At the start of the year, your 30-year old investment would be worth around $97,000.",
              align: "right",
              wrap: 200,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2020, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2020, 01, 01).getTime()).Value),
            dy: -5,
            dx: 0,
            connector: { end: "dot" }
          },
        ];
        svg.append("g")
           .call(d3.annotation().annotations(annotations));
      }

      async function nav4() {
        document.getElementById("subtitle").innerText = "2021 - 2022: Recession Fears and Conflict";

        const data = await fetchData();

        const xScale = d3.scaleTime()
            .domain(d3.extent(data.map(e => e.Date)))
            .range([margin.left, width - margin.right]);
        const yScale = d3.scaleLinear()
            .domain([0, d3.max(data, d => +d.Value)])
            .range([height - margin.bottom, margin.top]);

        var xAxis = d3.axisBottom(xScale).ticks(d3.timeYear);
        var yAxis = d3.axisLeft(yScale);

        d3.select("svg").html("");
        const svg = d3.select("svg")
                      .attr("width", width)
                      .attr("height", height);

        svg.append("g")
            .attr("transform", "translate(0," + (height - margin.bottom) + ")")
            .call(xAxis);
        svg.append("g")
           .attr("transform", "translate(" + margin.left + ",0)")
           .call(yAxis);
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("x", width / 2)
            .attr("y", height)
            .text("Year");
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("transform", "rotate(-90)")
            .attr("x", -height / 2 + margin.top)
            .attr("y", 20)
            .text("S&P 500 Index");

        svg.append("path")
           .datum(data.filter(e => e.Date <= new Date(2000, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2000, 01, 01) &&
             e.Date <= new Date(2003, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2003, 01, 01) &&
             e.Date <= new Date(2007, 02, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2007, 01, 01) &&
             e.Date <= new Date(2009, 02, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2009, 02, 01) &&
             e.Date <= new Date(2020, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2020, 01, 01) &&
             e.Date <= new Date(2020, 03, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2020, 03, 01) &&
             e.Date <= new Date(2021, 11, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 3)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2021, 11, 01) &&
             e.Date <= new Date(2022, 09, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 3)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));

        const annotations = [
          {
            note: {
              label: "Suppose you invested $10,000 into the S&P 500 in January 1990. We will track the value of this investment over time.",
              wrap: 200,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(1990, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(1990, 01, 01).getTime()).Value),
            dy: -225,
            dx: 25,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "A bull run in the late 1990s was fueled by fast growing Internet companies.",
              align: "middle",
              wrap: 150,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(1996, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(1996, 01, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The S&P 500 hit an all-time high of 1552.87 on March 24, 2000. At this point in time, your investment from 1990 would be worth around $46,000.",
              align: "right",
              wrap: 100,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2000, 03, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2000, 03, 01).getTime()).Value),
            dy: -200,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "At its lowest point around October 2002, the stock market had lost $5 trillion in market capitalization.",
              align: "middle",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2002, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2002, 10, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The housing bubble bursts, after housing prices peak in 2006, kicking off a mortage crisis.",
              align: "right",
              wrap: 150,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2007, 02, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2007, 02, 01).getTime()).Value),
            dy: 75,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "On October 11, 2007, the S&P 500 hit an all-time high 1576.09. At this point in time, your investment from 1990 would be worth around $46,000.",
              align: "middle",
              wrap: 150,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2007, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2007, 10, 01).getTime()).Value),
            dy: -175,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "On September 26, 2008, Washington Mutual goes bankrupt after a bank run.",
              align: "left",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2008, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2008, 10, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The S&P 500 regains the closing record from October 2007.",
              align: "middle",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2013, 03, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2013, 03, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "Through the 2010s, the S&P 500 grows steadily in one of the longest periods of market growth. ",
              align: "right",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2017, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2017, 01, 01).getTime()).Value),
            dy: 100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "In February 2020, the onset of the COVID-19 pandemic ends the peak of the bull run from 2009. At the start of the year, your 30-year old investment would be worth around $97,000.",
              align: "right",
              wrap: 200,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2020, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2020, 01, 01).getTime()).Value),
            dy: -5,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "With a surge of growth during the pandemic, in January 2022 the S&P 500 closes at 4796.56, an all-time record. Your original investment from 1990 would now be worth around $140,000.",
              align: "right",
              wrap: 250,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2021, 11, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2021, 11, 01).getTime()).Value),
            dy: 0,
            dx: -25,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "Russia invades Ukraine in February 2022.",
              align: "right",
              wrap: 75,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2022, 02, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2022, 02, 01).getTime()).Value),
            dy: 200,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The tech industry and venture capital slow down, as layoffs affect thousands of workers in late 2022.",
              align: "right",
              wrap: 100,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2022, 09, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2022, 09, 01).getTime()).Value),
            dy: 200,
            dx: 0,
            connector: { end: "dot" }
          },
        ];
        svg.append("g")
           .call(d3.annotation().annotations(annotations));
      }

      async function nav5() {
        document.getElementById("subtitle").innerText = "2023: Recovery and the Future";

        const data = await fetchData();

        const xScale = d3.scaleTime()
            .domain(d3.extent(data.map(e => e.Date)))
            .range([margin.left, width - margin.right]);
        const yScale = d3.scaleLinear()
            .domain([0, d3.max(data, d => +d.Value)])
            .range([height - margin.bottom, margin.top]);

        var xAxis = d3.axisBottom(xScale).ticks(d3.timeYear);
        var yAxis = d3.axisLeft(yScale);

        d3.select("svg").html("");
        const svg = d3.select("svg")
                      .attr("width", width)
                      .attr("height", height);

        svg.append("g")
            .attr("transform", "translate(0," + (height - margin.bottom) + ")")
            .call(xAxis);
        svg.append("g")
           .attr("transform", "translate(" + margin.left + ",0)")
           .call(yAxis);
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("x", width / 2)
            .attr("y", height)
            .text("Year");
        svg.append("text")
            .attr("text-anchor", "end")
            .attr("transform", "rotate(-90)")
            .attr("x", -height / 2 + margin.top)
            .attr("y", 20)
            .text("S&P 500 Index");

        svg.append("path")
           .datum(data.filter(e => e.Date <= new Date(2000, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2000, 01, 01) &&
             e.Date <= new Date(2003, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2003, 01, 01) &&
             e.Date <= new Date(2007, 02, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2007, 01, 01) &&
             e.Date <= new Date(2009, 02, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2009, 02, 01) &&
             e.Date <= new Date(2020, 01, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2020, 01, 01) &&
             e.Date <= new Date(2020, 03, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2020, 03, 01) &&
             e.Date <= new Date(2021, 11, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2021, 11, 01) &&
             e.Date <= new Date(2022, 09, 01)))
           .attr("fill", "none")
           .attr("stroke", "red")
           .attr("stroke-width", 1.5)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));
        svg.append("path")
           .datum(data.filter(e =>
             e.Date >= new Date(2022, 09, 01) &&
             e.Date <= new Date(2023, 07, 01)))
           .attr("fill", "none")
           .attr("stroke", "green")
           .attr("stroke-width", 3)
           .attr("d", d3.line()
                        .x(d => xScale(d.Date))
                        .y(d => yScale(d.Value)));

        const annotations = [
          {
            note: {
              label: "Suppose you invested $10,000 into the S&P 500 in January 1990. We will track the value of this investment over time.",
              wrap: 200,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(1990, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(1990, 01, 01).getTime()).Value),
            dy: -225,
            dx: 25,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "A bull run in the late 1990s was fueled by fast growing Internet companies.",
              align: "middle",
              wrap: 150,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(1996, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(1996, 01, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The S&P 500 hit an all-time high of 1552.87 on March 24, 2000. At this point in time, your investment from 1990 would be worth around $46,000.",
              align: "right",
              wrap: 100,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2000, 03, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2000, 03, 01).getTime()).Value),
            dy: -200,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "At its lowest point around October 2002, the stock market had lost $5 trillion in market capitalization.",
              align: "middle",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2002, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2002, 10, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The housing bubble bursts, after housing prices peak in 2006, kicking off a mortage crisis.",
              align: "right",
              wrap: 150,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2007, 02, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2007, 02, 01).getTime()).Value),
            dy: 75,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "On October 11, 2007, the S&P 500 hit an all-time high 1576.09. At this point in time, your investment from 1990 would be worth around $46,000.",
              align: "middle",
              wrap: 150,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2007, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2007, 10, 01).getTime()).Value),
            dy: -175,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "On September 26, 2008, Washington Mutual goes bankrupt after a bank run.",
              align: "left",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2008, 10, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2008, 10, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The S&P 500 regains the closing record from October 2007.",
              align: "middle",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2013, 03, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2013, 03, 01).getTime()).Value),
            dy: -100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "Through the 2010s, the S&P 500 grows steadily in one of the longest periods of market growth. ",
              align: "right",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2017, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2017, 01, 01).getTime()).Value),
            dy: 100,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "In February 2020, the onset of the COVID-19 pandemic ends the peak of the bull run from 2009. At the start of the year, your 30-year old investment would be worth around $97,000.",
              align: "right",
              wrap: 200,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2020, 01, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2020, 01, 01).getTime()).Value),
            dy: -5,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "With a surge of growth during the pandemic, in January 2022 the S&P 500 closes at 4796.56, an all-time record. Your original investment from 1990 would now be worth around $140,000.",
              align: "right",
              wrap: 250,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2021, 11, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2021, 11, 01).getTime()).Value),
            dy: 0,
            dx: -25,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "Russia invades Ukraine in February 2022.",
              align: "right",
              wrap: 75,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2022, 02, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2022, 02, 01).getTime()).Value),
            dy: 200,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The tech industry and venture capital slow down, as layoffs affect thousands of workers in late 2022.",
              align: "right",
              wrap: 100,
              padding: 5
            },
            color: ["#CFD0D1"],
            x: xScale(new Date(2022, 09, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2022, 09, 01).getTime()).Value),
            dy: 200,
            dx: 0,
            connector: { end: "dot" }
          },
          {
            note: {
              label: "The S&P 500 has appeared to be growing rapidly again in early 2023.",
              align: "middle",
              wrap: 75,
              padding: 5
            },
            color: ["#000000"],
            x: xScale(new Date(2023, 07, 01)),
            y: yScale(data.find(d =>
              d.Date.getTime() == new Date(2023, 06, 01).getTime()).Value),
            dy: 325,
            dx: 0,
            connector: { end: "dot" }
          }
        ];
        svg.append("g")
           .call(d3.annotation().annotations(annotations));
      }
    </script>
  </body>
</html>
